# Enmity Plugin Creation Prompt

Use this prompt with an AI assistant to create working Enmity plugins.

---

## PROMPT START

I need help creating a working Enmity Discord plugin. Here's the complete setup:

### Required Files Structure

```
my-plugin/
├── src/
│   └── index.tsx
├── dist/
│   └── [PluginName].js (generated by build)
├── manifest.json
├── package.json
├── rollup.config.ts
├── .gitignore
└── README.md
```

### 1. manifest.json
Create this file with my plugin details:
```json
{
   "name": "PluginName",
   "version": "1.0.0",
   "description": "Plugin description here",
   "authors": [
      {
         "name": "YourName",
         "id": "0"
      }
   ]
}
```

### 2. package.json
```json
{
  "name": "pluginname",
  "version": "1.0.0",
  "description": "Plugin description here",
  "main": "dist/PluginName.js",
  "scripts": {
    "build": "rollup -c --configPlugin esbuild"
  },
  "keywords": ["enmity", "plugin", "discord"],
  "author": "YourName",
  "license": "MIT",
  "devDependencies": {
    "@rollup/plugin-commonjs": "^21.0.1",
    "@rollup/plugin-json": "^4.1.0",
    "@rollup/plugin-node-resolve": "^13.1.1",
    "@types/node": "^17.0.5",
    "esbuild": "^0.14.9",
    "rollup": "^2.62.0",
    "rollup-plugin-esbuild": "^4.8.2"
  },
  "dependencies": {
    "enmity": "*"
  }
}
```

### 3. rollup.config.ts
```typescript
import { nodeResolve } from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import esbuild from 'rollup-plugin-esbuild';
import json from '@rollup/plugin-json';

import manifest from './manifest.json';
import { defineConfig } from 'rollup';

export default defineConfig({
   input: 'src/index.tsx',
   output: [
      {
         file: `dist/${manifest.name}.js`,
         format: 'cjs',
         strict: false
      },
   ],
   plugins: [
      nodeResolve(),
      commonjs(),
      json(),
      esbuild({ minify: true, target: 'ES2019' })
   ]
});
```

### 4. .gitignore
```
node_modules/
*.log
.DS_Store
```

### 5. src/index.tsx Template

Use this as the base structure for all plugins:

```typescript
import { Plugin, registerPlugin } from 'enmity/managers/plugins';
import { React } from 'enmity/metro/common';
import { bulk, filters } from 'enmity/metro';
import { create } from 'enmity/patcher';
import manifest from '../manifest.json';

const Patcher = create('your-plugin-id');

// Helper to get Discord modules
function getByProps(...props: string[]) {
    return window.enmity.modules.getByProps(...props);
}

const YourPlugin: Plugin = {
    ...manifest,
    
    onStart() {
        console.log('[YourPlugin] Plugin started');
        
        // Your plugin logic here
        // Example: Patch a function
        // const SomeModule = getByProps('functionName');
        // Patcher.after(SomeModule, 'functionName', (self, args, res) => {
        //     // Your code here
        // });
        
        // Example: Subscribe to Discord events
        // const { Dispatcher } = window.enmity.modules.common;
        // const handler = (event: any) => {
        //     console.log('Event received:', event);
        // };
        // Dispatcher.subscribe('EVENT_NAME', handler);
    },
    
    onStop() {
        console.log('[YourPlugin] Plugin stopped');
        Patcher.unpatchAll();
        
        // Unsubscribe from events if you subscribed
        // const { Dispatcher } = window.enmity.modules.common;
        // Dispatcher.unsubscribe('EVENT_NAME', handler);
    }
};

registerPlugin(YourPlugin);
```

### 6. Build Instructions

After creating all files:

```bash
# Install dependencies
npm install

# Build the plugin
npm run build
```

The compiled plugin will be in `dist/[PluginName].js`

### 7. Installation URL

Upload to GitHub and use:
```
https://raw.githubusercontent.com/username/repo/main/dist/PluginName.js
```

### Important Notes

1. **Always use `window.enmity` API** - Don't rely on imports for runtime APIs
2. **Use `getByProps()` helper** - For finding Discord modules
3. **Use Patcher** - For hooking into Discord functions
4. **Build before testing** - Raw TypeScript won't work
5. **Check console logs** - Use Console.app on Mac to debug iOS

### Common Patterns

**Finding Discord Modules:**
```typescript
const MessageStore = getByProps('getMessage', 'getMessages');
const UserStore = getByProps('getUser', 'getCurrentUser');
```

**Patching Functions:**
```typescript
Patcher.after(Module, 'functionName', (self, args, res) => {
    // Modify res or perform actions
    return res;
});
```

**Subscribing to Discord Events (CRITICAL - USE THIS METHOD):**
```typescript
// CORRECT WAY - Use Dispatcher from common
const { Dispatcher } = window.enmity.modules.common;

// Store handlers for cleanup
const subscriptions: any[] = [];

// Subscribe
const handler = (event: any) => {
    console.log('Event received:', event);
};
Dispatcher.subscribe('MESSAGE_CREATE', handler);
subscriptions.push({ type: 'MESSAGE_CREATE', handler });

// Unsubscribe in onStop
onStop() {
    const { Dispatcher } = window.enmity.modules.common;
    subscriptions.forEach((sub: any) => {
        Dispatcher.unsubscribe(sub.type, sub.handler);
    });
    subscriptions.length = 0;
}
```

**Common Discord Events:**
- `MESSAGE_CREATE` - New message sent
- `MESSAGE_DELETE` - Message deleted
- `MESSAGE_UPDATE` - Message edited
- `MESSAGE_DELETE_BULK` - Multiple messages deleted
- `CHANNEL_SELECT` - Channel switched
- `TYPING_START` - User starts typing

### Reference Links

- **Official Template**: https://github.com/enmity-mod/plugin-template
- **Enmity Source**: https://github.com/enmity-mod/enmity
- **Working Example**: https://github.com/m4fn3/BetterStatusIndicator
- **Plugin List**: https://enmity-addons.github.io/

### Working Example Plugin

MessageSniffer (message logger): https://github.com/abcwrlds/jslogger

### Common Issues & Fixes

**Issue: Plugin loads but features don't work**
- **Fix**: Use `window.enmity.modules.common.Dispatcher` instead of `getByProps('dispatch')`
- **Fix**: Store event handlers and unsubscribe properly in `onStop()`
- **Fix**: Add extensive console.log() statements to debug

**Issue: Commands don't register**
- **Fix**: Check if Commands module exists before registering
- **Fix**: Use correct command structure with `name`, `description`, `execute`

**Issue: Module not found**
- **Fix**: Use `getByProps()` with multiple property names
- **Fix**: Add fallback checks: `const Module = getByProps('prop1') || getByProps('prop2')`

**Issue: Plugin crashes on start**
- **Fix**: Wrap everything in try-catch blocks
- **Fix**: Check if modules exist before using them
- **Fix**: Add null checks for all Discord API calls

---

## MY PLUGIN IDEA:

[Enter your plugin idea here]

---

## INSTRUCTIONS FOR AI:

1. Create all the files listed above with appropriate names
2. Implement the plugin logic in `src/index.tsx` based on the idea
3. Make sure to use `window.enmity` API correctly
4. Add proper error handling with try-catch blocks
5. Include console.log statements for debugging
6. Test that the structure matches the working example

## PROMPT END
